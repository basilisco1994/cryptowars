System.register("chunks:///_virtual/MapControl.ts",["cc"],(function(e){"use strict";var t,o,i,n,a,l,r,c;return{setters:[function(e){t=e.cclegacy,o=e._decorator,i=e.Node,n=e.Label,a=e.Vec3,l=e.UITransform,r=e.log,c=e.Component}],execute:function(){var s,u,p,m,f,v,h,d,g,b,y,x,S,w,T,C,_;function M(e,t,o,i){o&&Object.defineProperty(e,t,{enumerable:o.enumerable,configurable:o.configurable,writable:o.writable,value:o.initializer?o.initializer.call(i):void 0})}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function E(e,t,o,i,n){var a={};return Object.keys(i).forEach((function(e){a[e]=i[e]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=o.slice().reverse().reduce((function(o,i){return i(e,t,o)||o}),a),n&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(n):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(e,t,a),a=null),a}t._RF.push({},"9ed6fzToXhOBafgVG1A1ohc","MapControl",void 0);var R=o.ccclass,A=o.property;e("MapControl",(s=R("MapControl"),u=A({type:i,tooltip:"Target_Node"}),p=A(n),m=A({tooltip:"Image_initial_zoom"}),f=A({tooltip:"Image_zoom_minimum_scale"}),v=A({tooltip:"Image_zoom_maximum_scale"}),h=A({tooltip:"Single-touch_tolerance"}),d=A({tooltip:"Scroll_Wheel_zoom_ratio"}),s((y=E((b=function(e){var t,o;function n(){for(var t,o=arguments.length,i=new Array(o),n=0;n<o;n++)i[n]=arguments[n];return M(z(t=e.call.apply(e,[this].concat(i))||this),"map",y,z(t)),M(z(t),"scaleTime",x,z(t)),M(z(t),"defaultScaling",S,z(t)),M(z(t),"minScale",w,z(t)),M(z(t),"maxScale",T,z(t)),M(z(t),"moveOffset",C,z(t)),M(z(t),"increaseRate",_,z(t)),O(z(t),"locked",!1),O(z(t),"isMoving",!1),O(z(t),"singleTouchCb",null),t}o=e,(t=n).prototype=Object.create(o.prototype),t.prototype.constructor=t,t.__proto__=o;var c=n.prototype;return c.start=function(){this.addEvent(),this.smoothOperate(this.map,new a(0,0,0),new a(this.defaultScaling,this.defaultScaling,this.defaultScaling))},c.canStartMove=function(e){var t=e.getStartLocation(),o=e.getLocation();return Math.abs(o.x-t.x)>this.moveOffset||Math.abs(o.y-t.y)>this.moveOffset},c.addEvent=function(){var e=this;this.node.on(i.EventType.TOUCH_MOVE,(function(t){if(!e.locked){var o=t.getTouches();if(o.length>=2){var i,n;e.isMoving=!0;var r=o[0],c=o[1],s=r.getDelta(),u=c.getDelta(),p=null===(i=e.map.getComponent(l))||void 0===i?void 0:i.convertToNodeSpaceAR(new a(r.x,r.y,0)),m=null===(n=e.map.getComponent(l))||void 0===n?void 0:n.convertToNodeSpaceAR(new a(c.x,c.y,0)),f=p.subtract(m),v=s.subtract(u),h=1;h=Math.abs(f.x)>Math.abs(f.y)?(f.x+v.x)/f.x*e.map.scale.x:(f.y+v.y)/f.y*e.map.scale.y;var d=m.add(new a(f.x/2,f.y/2));e.smoothOperate(e.map,d,new a(h,h,h))}else 1===o.length&&(e.isMoving||e.canStartMove(o[0]))&&(e.isMoving=!0,e.dealMove(o[0].getDelta(),e.map,e.node))}}),this),this.node.on(i.EventType.TOUCH_END,(function(t){if(!e.locked&&t.getTouches().length<=1){if(!e.isMoving){var o,i=t.getLocation(),n=null===(o=e.map.getComponent(l))||void 0===o?void 0:o.convertToNodeSpaceAR(new a(i.x,i.y,0));e.dealSelect(n)}e.isMoving=!1}}),this),this.node.on(i.EventType.TOUCH_CANCEL,(function(t){e.locked||t.getTouches().length<=1&&(e.isMoving=!1)}),this),this.node.on(i.EventType.MOUSE_WHEEL,(function(t){var o;if(!e.locked){var i=t.getLocation(),n=t.getScrollY(),r=e.map.scale.x+n/e.increaseRate,c=e.map,s=null===(o=c.getComponent(l))||void 0===o?void 0:o.convertToNodeSpaceAR(new a(i.x,i.y,0));e.smoothOperate(c,s,new a(r,r,0))}}),this)},c.smoothOperate=function(e,t,o){if(this.minScale<=o.x&&o.x<=this.maxScale){var i=o.x-e.scale.x,n=t.multiplyScalar(i),l=e.position.subtract(n),r=Math.floor(100*o.x)/100;e.scale=new a(r,r,0),this.dealScalePos(l,e)}else o=o.clampf(new a(this.minScale,this.minScale,this.minScale),new a(this.maxScale,this.maxScale,this.maxScale));this.scaleTime.string=Math.floor(100*o.x)+"%"},c.dealScalePos=function(e,t){if(1===t.scale.x)e=new a(0,0,0);else{var o,i,n=null===(o=this.node.getComponent(l))||void 0===o?void 0:o.convertToWorldSpaceAR(e),r=null===(i=this.node.getComponent(l))||void 0===i?void 0:i.convertToNodeSpaceAR(new a(n.x,n.y,0)),c=this.calculateEdge(t,this.node,r);c.left>0&&(e.x-=c.left),c.right>0&&(e.x+=c.right),c.top>0&&(e.y+=c.top),c.bottom>0&&(e.y-=c.bottom)}t.position=e},c.dealMove=function(e,t,o){var i,n,r=null===(i=t.getComponent(l))||void 0===i?void 0:i.convertToWorldSpaceAR(new a(0,0,0)),c=null===(n=o.getComponent(l))||void 0===n?void 0:n.convertToNodeSpaceAR(new a(r.x,r.y,0));c.x+=e.x,c.y+=e.y;var s=this.calculateEdge(t,o,c),u=t.position.x,p=t.position.y;s.left<=0&&s.right<=0&&(u=t.position.x+e.x),s.top<=0&&s.bottom<=0&&(p=t.position.y+e.y),t.setPosition(u,p,0)},c.dealSelect=function(e){r("click map on ("+e.x+", "+e.y+")"),this.singleTouchCb&&this.singleTouchCb(e)},c.calculateEdge=function(e,t,o){var i=(t.getComponent(l).width-e.getComponent(l).width*e.scale.x)/2,n=(t.getComponent(l).height-e.getComponent(l).height*e.scale.y)/2;return{left:i+o.x,right:i-o.x,top:n-o.y,bottom:n+o.y}},n}(c)).prototype,"map",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x=E(b.prototype,"scaleTime",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S=E(b.prototype,"defaultScaling",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.1}}),w=E(b.prototype,"minScale",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),T=E(b.prototype,"maxScale",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.8}}),C=E(b.prototype,"moveOffset",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),_=E(b.prototype,"increaseRate",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),g=b))||g));t._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./MapControl.ts"],(function(){"use strict";return{setters:[function(){}],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});